<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Novel NLP - API Tools</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .api-url {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin-bottom: 15px;
        }
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-links a {
            color: #3498db;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border: 1px solid #3498db;
            border-radius: 5px;
        }
        .nav-links a:hover {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="nav-links">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/api-tools.html">API Tools</a>
                 <a href="https://lightnovel-backend.onrender.com/docs" target="_blank">Swagger Docs</a>
    </div>

    <h1>üîß Light Novel NLP - API Tools</h1>

    <div class="container">
        <h2>üìä –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="api-url" id="apiUrl">API URL: <span id="currentUrl">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
        <button onclick="checkHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ API</button>
        <button onclick="getInfo()">–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
        <div id="systemResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
                <div class="form-group">
                    <label for="projectName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="text" id="projectName" placeholder="–ú–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç">
                </div>
                <div class="form-group">
                    <label for="projectGenre">–ñ–∞–Ω—Ä –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <select id="projectGenre">
                        <option value="fantasy">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</option>
                        <option value="scifi">–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</option>
                        <option value="romance">–†–æ–º–∞–Ω—Ç–∏–∫–∞</option>
                        <option value="action">–ë–æ–µ–≤–∏–∫</option>
                        <option value="mystery">–î–µ—Ç–µ–∫—Ç–∏–≤/–ú–∏—Å—Ç–µ—Ä–∏—è</option>
                        <option value="horror">–£–∂–∞—Å—ã</option>
                        <option value="slice_of_life">–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ—Å—Ç—å</option>
                        <option value="adventure">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <button onclick="createProject()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å/–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</h3>
                <button onclick="getProjects()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</button>
                <div class="form-group" style="margin-top:10px;">
                    <label for="deleteProjectId">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:</label>
                    <select id="deleteProjectId">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <button onclick="deleteProject()" class="danger">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</button>
            </div>
        </div>
        <div id="projectsResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–∞–º–∏</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É</h3>
                <div class="form-group">
                    <label for="chapterProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="chapterProjectId">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="chapterTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã:</label>
                    <input type="text" id="chapterTitle" placeholder="–ì–ª–∞–≤–∞ 1">
                </div>
                <div class="form-group">
                    <label for="chapterText">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
                    <textarea id="chapterText" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã..."></textarea>
                </div>
                <button onclick="createChapter()">–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å –≥–ª–∞–≤—ã –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-group">
                    <label for="getChaptersProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="getChaptersProjectId">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <button onclick="getChapters()">–ü–æ–ª—É—á–∏—Ç—å –≥–ª–∞–≤—ã</button>
            </div>
        </div>
        <div id="chaptersResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å —Ç–µ—Ä–º–∏–Ω</h3>
                <div class="form-group">
                    <label for="termProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="termProjectId">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sourceTerm">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="sourceTerm" placeholder="‰∏ª‰∫∫ÂÖ¨">
                </div>
                <div class="form-group">
                    <label for="translatedTerm">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="translatedTerm" placeholder="–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π">
                </div>
                <div class="form-group">
                    <label for="termCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="termCategory">
                        <option value="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</option>
                        <option value="location">–õ–æ–∫–∞—Ü–∏—è</option>
                        <option value="skill">–ù–∞–≤—ã–∫</option>
                        <option value="artifact">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="termContext">–ö–æ–Ω—Ç–µ–∫—Å—Ç:</label>
                    <textarea id="termContext" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ä–º–∏–Ω–µ..."></textarea>
                </div>
                <button onclick="createTerm()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Ä–º–∏–Ω</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-group">
                    <label for="getTermsProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="getTermsProjectId">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <button onclick="getTerms()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã</button>
            </div>
        </div>
        <div id="glossaryResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–º–∏</h2>
        <div class="grid">
            <div>
                <h3>–£—Ç–≤–µ—Ä–¥–∏—Ç—å/–û—Ç–∫–ª–æ–Ω–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã</h3>
                <div class="form-group">
                    <label for="manageTermsProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="manageTermsProjectId" onchange="loadTermsForManagement()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="manageTermsList">–¢–µ—Ä–º–∏–Ω—ã (pending):</label>
                    <select id="manageTermsList" disabled>
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <button onclick="approveTerm()" id="approveBtn" disabled>‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button onclick="rejectTerm()" id="rejectBtn" disabled>‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </div>
            <div>
                <h3>–°—Ç–∞—Ç—É—Å —Ç–µ—Ä–º–∏–Ω–æ–≤</h3>
                <div id="termsStatus" style="margin-top: 20px;">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤</p>
                </div>
            </div>
        </div>
        <div id="termManagementResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤</h2>
        <div class="grid">
            <div>
                <h3>–í—ã–±—Ä–∞—Ç—å —Ç–µ—Ä–º–∏–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="form-group">
                    <label for="editTermsProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="editTermsProjectId" onchange="loadAllTermsForEdit()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTermsList">–¢–µ—Ä–º–∏–Ω:</label>
                    <select id="editTermsList" disabled onchange="loadTermForEdit()">
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                    </select>
                </div>
            </div>
            <div>
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω</h3>
                <div class="form-group">
                    <label for="editSourceTerm">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="editSourceTerm" placeholder="‰∏ª‰∫∫ÂÖ¨">
                </div>
                <div class="form-group">
                    <label for="editTranslatedTerm">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="editTranslatedTerm" placeholder="–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π">
                </div>
                <div class="form-group">
                    <label for="editTermCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="editTermCategory">
                        <option value="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</option>
                        <option value="location">–õ–æ–∫–∞—Ü–∏—è</option>
                        <option value="skill">–ù–∞–≤—ã–∫</option>
                        <option value="artifact">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTermContext">–ö–æ–Ω—Ç–µ–∫—Å—Ç:</label>
                    <textarea id="editTermContext" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ä–º–∏–Ω–µ..."></textarea>
                </div>
                <button onclick="updateTerm()" id="updateBtn" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
        <div id="editTermsResponse" class="response" style="display: none;"></div>
    </div>

         <div class="container">
         <h2>üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥</h2>
         <div class="grid">
             <div>
                 <h3>–ê–Ω–∞–ª–∏–∑ –≥–ª–∞–≤—ã</h3>
                 <div class="form-group">
                     <label for="analyzeProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                     <select id="analyzeProjectId" onchange="loadChaptersForAnalysis()">
                         <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                     </select>
                 </div>
                 <div class="form-group">
                     <label for="analyzeChapterId">–ì–ª–∞–≤–∞:</label>
                     <select id="analyzeChapterId" disabled>
                         <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                     </select>
                 </div>
                 <button onclick="analyzeChapter()" id="analyzeBtn" disabled>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–ª–∞–≤—É</button>
             </div>
             <div>
                 <h3>–ü–µ—Ä–µ–≤–æ–¥ –≥–ª–∞–≤—ã</h3>
                 <div class="form-group">
                     <label for="translateProjectId">–ü—Ä–æ–µ–∫—Ç:</label>
                     <select id="translateProjectId" onchange="loadChaptersForTranslation()">
                         <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                     </select>
                 </div>
                 <div class="form-group">
                     <label for="translateChapterId">–ì–ª–∞–≤–∞:</label>
                     <select id="translateChapterId" disabled>
                         <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>
                     </select>
                 </div>
                 <div class="form-group">
                     <label>
                         <input type="checkbox" id="useGlossary" checked> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏–π
                     </label>
                 </div>
                 <button onclick="translateChapter()" id="translateBtn" disabled>–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥–ª–∞–≤—É</button>
             </div>
         </div>
         <div id="processingResponse" class="response" style="display: none;"></div>
     </div>

    <div class="container">
        <h2>üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
        <div class="grid">
            <div>
                <button onclick="getApiUsage()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API</button>
            </div>
            <div>
                <button onclick="getCacheStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞</button>
            </div>
        </div>
        <div id="monitoringResponse" class="response" style="display: none;"></div>
    </div>

    <script>
                     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL API
             const API_BASE_URL = window.location.hostname === 'localhost' 
                 ? 'http://localhost:8000' 
                 : 'https://lightnovel-backend.onrender.com';

        document.getElementById('currentUrl').textContent = API_BASE_URL;

        // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, data: { error: error.message }, status: 0 };
            }
        }

        function showResponse(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${result.success ? 'success' : 'error'}`;
            element.textContent = JSON.stringify(result.data, null, 2);
        }

        // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function checkHealth() {
            const result = await makeRequest(`${API_BASE_URL}/health`);
            showResponse('systemResponse', result);
        }

        async function getInfo() {
            const result = await makeRequest(`${API_BASE_URL}/info`);
            showResponse('systemResponse', result);
        }

        // –ü—Ä–æ–µ–∫—Ç—ã
        async function createProject() {
            const name = document.getElementById('projectName').value;
            const genre = document.getElementById('projectGenre').value;
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/projects/`, {
                method: 'POST',
                body: JSON.stringify({ name, genre })
            });
            showResponse('projectsResponse', result);
            if (result.success) {
                document.getElementById('projectName').value = '';
                loadProjects(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
            }
        }

        async function getProjects() {
            const result = await makeRequest(`${API_BASE_URL}/projects/`);
            showResponse('projectsResponse', result);
            // –û–±–Ω–æ–≤–∏–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
            if (result.success) {
                const projects = result.data;
                const selects = ['chapterProjectId','getChaptersProjectId','termProjectId','getTermsProjectId','analyzeProjectId','translateProjectId','manageTermsProjectId','editTermsProjectId','deleteProjectId'];
                selects.forEach(id => {
                    const sel = document.getElementById(id);
                    if (!sel) return;
                    sel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                    projects.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p.id;
                        opt.textContent = `${p.name} (${p.genre})`;
                        sel.appendChild(opt);
                    });
                });
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
        async function deleteProject() {
            const select = document.getElementById('deleteProjectId');
            const projectId = select.value;
            if (!projectId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            const confirmed = confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');
            if (!confirmed) return;
            const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}`, { method: 'DELETE' });
            showResponse('projectsResponse', result);
            if (result.success) {
                loadProjects();
            }
        }

                     // –ì–ª–∞–≤—ã
             async function createChapter() {
                 const projectId = document.getElementById('chapterProjectId').value;
                 const title = document.getElementById('chapterTitle').value;
                 const text = document.getElementById('chapterText').value;
     
                 if (!projectId || !title || !text) {
                     alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                     return;
                 }
     
                 const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`, {
                     method: 'POST',
                     body: JSON.stringify({ title, original_text: text })
                 });
                 showResponse('chaptersResponse', result);
             }

                     async function getChapters() {
                 const projectId = document.getElementById('getChaptersProjectId').value;
                 if (!projectId) {
                     alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                     return;
                 }
     
                 const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`);
                 showResponse('chaptersResponse', result);
             }

                     // –ì–ª–æ—Å—Å–∞—Ä–∏–π
             async function createTerm() {
                 const projectId = document.getElementById('termProjectId').value;
                 const sourceTerm = document.getElementById('sourceTerm').value;
                 const translatedTerm = document.getElementById('translatedTerm').value;
                 const category = document.getElementById('termCategory').value;
                 const context = document.getElementById('termContext').value;
     
                 if (!projectId || !sourceTerm || !translatedTerm) {
                     alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                     return;
                 }
     
                 const result = await makeRequest(`${API_BASE_URL}/glossary/terms`, {
                     method: 'POST',
                     body: JSON.stringify({
                         project_id: projectId,
                         source_term: sourceTerm,
                         translated_term: translatedTerm,
                         category,
                         context
                     })
                 });
                 showResponse('glossaryResponse', result);
             }

        async function getTerms() {
            const projectId = document.getElementById('getTermsProjectId').value;
            if (!projectId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${projectId}`);
            showResponse('glossaryResponse', result);
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–º–∏
        async function loadTermsForManagement() {
            const projectId = document.getElementById('manageTermsProjectId').value;
            const termsList = document.getElementById('manageTermsList');
            const approveBtn = document.getElementById('approveBtn');
            const rejectBtn = document.getElementById('rejectBtn');
            const termsStatus = document.getElementById('termsStatus');

            if (!projectId) {
                termsList.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                termsList.disabled = true;
                approveBtn.disabled = true;
                rejectBtn.disabled = true;
                termsStatus.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤</p>';
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${projectId}/pending`);
            if (result.success) {
                const terms = result.data;
                termsList.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è...</option>';
                terms.forEach(term => {
                    const option = document.createElement('option');
                    option.value = term.id;
                    option.textContent = `${term.source_term} -> ${term.translated_term} (ID: ${term.id})`;
                    termsList.appendChild(option);
                });
                termsList.disabled = false;
                approveBtn.disabled = false;
                rejectBtn.disabled = false;
                termsStatus.innerHTML = `<p>–ù–∞–π–¥–µ–Ω–æ <strong>${terms.length}</strong> —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</p>`;
            } else {
                termsList.innerHTML = '<option value="">–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</option>';
                termsList.disabled = true;
                approveBtn.disabled = true;
                rejectBtn.disabled = true;
                termsStatus.innerHTML = '<p>–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</p>';
            }
        }

        async function approveTerm() {
            const termId = document.getElementById('manageTermsList').value;
            if (!termId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${termId}/approve`, {
                method: 'POST'
            });
            showResponse('termManagementResponse', result);
            loadTermsForManagement(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        }

        async function rejectTerm() {
            const termId = document.getElementById('manageTermsList').value;
            if (!termId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${termId}/reject`, {
                method: 'POST'
            });
            showResponse('termManagementResponse', result);
            loadTermsForManagement(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤
        async function loadAllTermsForEdit() {
            const projectId = document.getElementById('editTermsProjectId').value;
            const termsList = document.getElementById('editTermsList');
            const updateBtn = document.getElementById('updateBtn');

            if (!projectId) {
                termsList.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                termsList.disabled = true;
                updateBtn.disabled = true;
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${projectId}`);
            if (result.success) {
                const terms = result.data;
                termsList.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</option>';
                terms.forEach(term => {
                    const option = document.createElement('option');
                    option.value = term.id;
                    option.textContent = `${term.source_term} -> ${term.translated_term} (${term.status}) [ID: ${term.id}]`;
                    termsList.appendChild(option);
                });
                termsList.disabled = false;
            } else {
                termsList.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤</option>';
                termsList.disabled = true;
                updateBtn.disabled = true;
            }
        }

        async function loadTermForEdit() {
            const termId = document.getElementById('editTermsList').value;
            const updateBtn = document.getElementById('updateBtn');

            if (!termId) {
                updateBtn.disabled = true;
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
                document.getElementById('editSourceTerm').value = '';
                document.getElementById('editTranslatedTerm').value = '';
                document.getElementById('editTermCategory').value = 'character';
                document.getElementById('editTermContext').value = '';
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${termId}/details`);
            if (result.success) {
                const term = result.data;
                document.getElementById('editSourceTerm').value = term.source_term;
                document.getElementById('editTranslatedTerm').value = term.translated_term;
                document.getElementById('editTermCategory').value = term.category;
                document.getElementById('editTermContext').value = term.context || '';
                updateBtn.disabled = false;
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞');
                updateBtn.disabled = true;
            }
        }

        async function updateTerm() {
            const termId = document.getElementById('editTermsList').value;
            const sourceTerm = document.getElementById('editSourceTerm').value;
            const translatedTerm = document.getElementById('editTranslatedTerm').value;
            const category = document.getElementById('editTermCategory').value;
            const context = document.getElementById('editTermContext').value;

            if (!termId || !sourceTerm || !translatedTerm) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms/${termId}`, {
                method: 'PUT',
                body: JSON.stringify({
                    translated_term: translatedTerm,
                    category,
                    context
                })
            });
            showResponse('editTermsResponse', result);
            
            if (result.success) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                loadAllTermsForEdit();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞
        async function analyzeChapter() {
            const chapterId = document.getElementById('analyzeChapterId').value;
            if (!chapterId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –≥–ª–∞–≤—ã');
                return;
            }
            
            const parsedChapterId = parseInt(chapterId);
            if (isNaN(parsedChapterId)) {
                alert('ID –≥–ª–∞–≤—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/processing/chapters/${parsedChapterId}/analyze`, {
                method: 'POST'
            });
            showResponse('processingResponse', result);
        }

        async function translateChapter() {
            const chapterId = document.getElementById('translateChapterId').value;
            const useGlossary = document.getElementById('useGlossary').checked;

            if (!chapterId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –≥–ª–∞–≤—ã');
                return;
            }
            
            const parsedChapterId = parseInt(chapterId);
            if (isNaN(parsedChapterId)) {
                alert('ID –≥–ª–∞–≤—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/translation/chapters/${parsedChapterId}/translate`, {
                method: 'POST'
            });
            showResponse('processingResponse', result);
        }

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        async function getApiUsage() {
            const result = await makeRequest(`${API_BASE_URL}/glossary/api-usage`);
            showResponse('monitoringResponse', result);
        }

        async function getCacheStats() {
            const result = await makeRequest(`${API_BASE_URL}/glossary/cache-stats`);
            showResponse('monitoringResponse', result);
        }

                 // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
         async function loadProjects() {
             const result = await makeRequest(`${API_BASE_URL}/projects/`);
             if (result.success) {
                 const projects = result.data;
                 
                 // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ —Å–µ–ª–µ–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
                 const projectSelects = ['analyzeProjectId', 'translateProjectId', 'manageTermsProjectId', 'chapterProjectId', 'getChaptersProjectId', 'termProjectId', 'getTermsProjectId', 'editTermsProjectId'];
                 projectSelects.forEach(selectId => {
                     const select = document.getElementById(selectId);
                     select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                     projects.forEach(project => {
                         const option = document.createElement('option');
                         option.value = project.id;
                         const genreLabel = getGenreLabel(project.genre);
                         option.textContent = `${project.name} (${genreLabel})`;
                         select.appendChild(option);
                     });
                 });
             }
         }

         async function loadChaptersForAnalysis() {
             const projectId = document.getElementById('analyzeProjectId').value;
             const chapterSelect = document.getElementById('analyzeChapterId');
             const analyzeBtn = document.getElementById('analyzeBtn');
             
             if (!projectId) {
                 chapterSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                 chapterSelect.disabled = true;
                 analyzeBtn.disabled = true;
                 return;
             }
             
             const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`);
             if (result.success) {
                 const chapters = result.data;
                 chapterSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É...</option>';
                 chapters.forEach(chapter => {
                     const option = document.createElement('option');
                     option.value = chapter.id;
                     const status = chapter.summary ? '‚úì –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞' : '‚óã –ù–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞';
                     option.textContent = `${chapter.title} (${status})`;
                     chapterSelect.appendChild(option);
                 });
                 chapterSelect.disabled = false;
                 analyzeBtn.disabled = false;
             }
         }

         async function loadChaptersForTranslation() {
             const projectId = document.getElementById('translateProjectId').value;
             const chapterSelect = document.getElementById('translateChapterId');
             const translateBtn = document.getElementById('translateBtn');
             
             if (!projectId) {
                 chapterSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç...</option>';
                 chapterSelect.disabled = true;
                 translateBtn.disabled = true;
                 return;
             }
             
             const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`);
             if (result.success) {
                 const chapters = result.data;
                 chapterSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É...</option>';
                 chapters.forEach(chapter => {
                     const option = document.createElement('option');
                     option.value = chapter.id;
                     const status = chapter.translated_text ? '‚úì –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–∞' : '‚óã –ù–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞';
                     option.textContent = `${chapter.title} (${status})`;
                     chapterSelect.appendChild(option);
                 });
                 chapterSelect.disabled = false;
                 translateBtn.disabled = false;
             }
         }

         // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥–∞
         async function analyzeChapter() {
             const chapterId = document.getElementById('analyzeChapterId').value;
             if (!chapterId) {
                 alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                 return;
             }

             const result = await makeRequest(`${API_BASE_URL}/processing/chapters/${chapterId}/analyze`, {
                 method: 'POST'
             });
             showResponse('processingResponse', result);
             
             // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
             if (result.success) {
                 setTimeout(loadChaptersForAnalysis, 1000);
             }
         }

         async function translateChapter() {
             const chapterId = document.getElementById('translateChapterId').value;
             const useGlossary = document.getElementById('useGlossary').checked;

             if (!chapterId) {
                 alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞');
                 return;
             }

             const result = await makeRequest(`${API_BASE_URL}/translation/chapters/${chapterId}/translate`, {
                 method: 'POST'
             });
             showResponse('processingResponse', result);
             
             // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞
             if (result.success) {
                 setTimeout(loadChaptersForTranslation, 1000);
             }
         }

         // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –∂–∞–Ω—Ä–∞
         function getGenreLabel(genre) {
             const labels = {
                 'fantasy': '–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞',
                 'scifi': '–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞',
                 'romance': '–†–æ–º–∞–Ω—Ç–∏–∫–∞',
                 'action': '–ë–æ–µ–≤–∏–∫',
                 'mystery': '–î–µ—Ç–µ–∫—Ç–∏–≤',
                 'horror': '–£–∂–∞—Å—ã',
                 'slice_of_life': '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ—Å—Ç—å',
                 'adventure': '–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è',
                 'other': '–î—Ä—É–≥–æ–µ'
             };
             return labels[genre] || genre;
         }

         // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
         window.addEventListener('load', async () => {
             await checkHealth();
             await loadProjects();
         });
    </script>
</body>
</html>
