<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Novel NLP - API Tools</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .api-url {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin-bottom: 15px;
        }
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-links a {
            color: #3498db;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border: 1px solid #3498db;
            border-radius: 5px;
        }
        .nav-links a:hover {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="nav-links">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/api-tools.html">API Tools</a>
        <a href="/docs" target="_blank">Swagger Docs</a>
    </div>

    <h1>üîß Light Novel NLP - API Tools</h1>

    <div class="container">
        <h2>üìä –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="api-url" id="apiUrl">API URL: <span id="currentUrl">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
        <button onclick="checkHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ API</button>
        <button onclick="getInfo()">–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
        <div id="systemResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
                <div class="form-group">
                    <label for="projectName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="text" id="projectName" placeholder="–ú–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç">
                </div>
                <button onclick="createProject()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</h3>
                <button onclick="getProjects()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</button>
            </div>
        </div>
        <div id="projectsResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–∞–º–∏</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É</h3>
                <div class="form-group">
                    <label for="chapterProjectId">ID –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="number" id="chapterProjectId" placeholder="1">
                </div>
                <div class="form-group">
                    <label for="chapterTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã:</label>
                    <input type="text" id="chapterTitle" placeholder="–ì–ª–∞–≤–∞ 1">
                </div>
                <div class="form-group">
                    <label for="chapterText">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
                    <textarea id="chapterText" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã..."></textarea>
                </div>
                <button onclick="createChapter()">–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å –≥–ª–∞–≤—ã –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-group">
                    <label for="getChaptersProjectId">ID –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="number" id="getChaptersProjectId" placeholder="1">
                </div>
                <button onclick="getChapters()">–ü–æ–ª—É—á–∏—Ç—å –≥–ª–∞–≤—ã</button>
            </div>
        </div>
        <div id="chaptersResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å —Ç–µ—Ä–º–∏–Ω</h3>
                <div class="form-group">
                    <label for="termProjectId">ID –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="number" id="termProjectId" placeholder="1">
                </div>
                <div class="form-group">
                    <label for="sourceTerm">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="sourceTerm" placeholder="‰∏ª‰∫∫ÂÖ¨">
                </div>
                <div class="form-group">
                    <label for="translatedTerm">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ—Ä–º–∏–Ω:</label>
                    <input type="text" id="translatedTerm" placeholder="–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π">
                </div>
                <div class="form-group">
                    <label for="termCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="termCategory">
                        <option value="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</option>
                        <option value="location">–õ–æ–∫–∞—Ü–∏—è</option>
                        <option value="skill">–ù–∞–≤—ã–∫</option>
                        <option value="artifact">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="termContext">–ö–æ–Ω—Ç–µ–∫—Å—Ç:</label>
                    <textarea id="termContext" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ä–º–∏–Ω–µ..."></textarea>
                </div>
                <button onclick="createTerm()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Ä–º–∏–Ω</button>
            </div>
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-group">
                    <label for="getTermsProjectId">ID –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input type="number" id="getTermsProjectId" placeholder="1">
                </div>
                <button onclick="getTerms()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã</button>
            </div>
        </div>
        <div id="glossaryResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥</h2>
        <div class="grid">
            <div>
                <h3>–ê–Ω–∞–ª–∏–∑ –≥–ª–∞–≤—ã</h3>
                <div class="form-group">
                    <label for="analyzeChapterId">ID –≥–ª–∞–≤—ã:</label>
                    <input type="number" id="analyzeChapterId" placeholder="1">
                </div>
                <button onclick="analyzeChapter()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–ª–∞–≤—É</button>
            </div>
            <div>
                <h3>–ü–µ—Ä–µ–≤–æ–¥ –≥–ª–∞–≤—ã</h3>
                <div class="form-group">
                    <label for="translateChapterId">ID –≥–ª–∞–≤—ã:</label>
                    <input type="number" id="translateChapterId" placeholder="1">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="useGlossary" checked> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏–π
                    </label>
                </div>
                <button onclick="translateChapter()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥–ª–∞–≤—É</button>
            </div>
        </div>
        <div id="processingResponse" class="response" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
        <div class="grid">
            <div>
                <button onclick="getApiUsage()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API</button>
            </div>
            <div>
                <button onclick="getCacheStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞</button>
            </div>
        </div>
        <div id="monitoringResponse" class="response" style="display: none;"></div>
    </div>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL API
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000' 
            : window.location.origin.replace('lightnovel-frontend', 'lightnovel-backend');

        document.getElementById('currentUrl').textContent = API_BASE_URL;

        // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, data: { error: error.message }, status: 0 };
            }
        }

        function showResponse(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${result.success ? 'success' : 'error'}`;
            element.textContent = JSON.stringify(result.data, null, 2);
        }

        // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function checkHealth() {
            const result = await makeRequest(`${API_BASE_URL}/health`);
            showResponse('systemResponse', result);
        }

        async function getInfo() {
            const result = await makeRequest(`${API_BASE_URL}/info`);
            showResponse('systemResponse', result);
        }

        // –ü—Ä–æ–µ–∫—Ç—ã
        async function createProject() {
            const name = document.getElementById('projectName').value;
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/projects/`, {
                method: 'POST',
                body: JSON.stringify({ name })
            });
            showResponse('projectsResponse', result);
        }

        async function getProjects() {
            const result = await makeRequest(`${API_BASE_URL}/projects/`);
            showResponse('projectsResponse', result);
        }

        // –ì–ª–∞–≤—ã
        async function createChapter() {
            const projectId = document.getElementById('chapterProjectId').value;
            const title = document.getElementById('chapterTitle').value;
            const text = document.getElementById('chapterText').value;

            if (!projectId || !title || !text) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`, {
                method: 'POST',
                body: JSON.stringify({ title, original_text: text })
            });
            showResponse('chaptersResponse', result);
        }

        async function getChapters() {
            const projectId = document.getElementById('getChaptersProjectId').value;
            if (!projectId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–æ–µ–∫—Ç–∞');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/projects/${projectId}/chapters`);
            showResponse('chaptersResponse', result);
        }

        // –ì–ª–æ—Å—Å–∞—Ä–∏–π
        async function createTerm() {
            const projectId = document.getElementById('termProjectId').value;
            const sourceTerm = document.getElementById('sourceTerm').value;
            const translatedTerm = document.getElementById('translatedTerm').value;
            const category = document.getElementById('termCategory').value;
            const context = document.getElementById('termContext').value;

            if (!projectId || !sourceTerm || !translatedTerm) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms`, {
                method: 'POST',
                body: JSON.stringify({
                    project_id: parseInt(projectId),
                    source_term: sourceTerm,
                    translated_term: translatedTerm,
                    category,
                    context
                })
            });
            showResponse('glossaryResponse', result);
        }

        async function getTerms() {
            const projectId = document.getElementById('getTermsProjectId').value;
            if (!projectId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–æ–µ–∫—Ç–∞');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/glossary/terms?project_id=${projectId}`);
            showResponse('glossaryResponse', result);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞
        async function analyzeChapter() {
            const chapterId = document.getElementById('analyzeChapterId').value;
            if (!chapterId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –≥–ª–∞–≤—ã');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/processing/analyze`, {
                method: 'POST',
                body: JSON.stringify({ chapter_id: parseInt(chapterId) })
            });
            showResponse('processingResponse', result);
        }

        async function translateChapter() {
            const chapterId = document.getElementById('translateChapterId').value;
            const useGlossary = document.getElementById('useGlossary').checked;

            if (!chapterId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –≥–ª–∞–≤—ã');
                return;
            }

            const result = await makeRequest(`${API_BASE_URL}/translation/translate`, {
                method: 'POST',
                body: JSON.stringify({ 
                    chapter_id: parseInt(chapterId),
                    use_glossary: useGlossary
                })
            });
            showResponse('processingResponse', result);
        }

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        async function getApiUsage() {
            const result = await makeRequest(`${API_BASE_URL}/glossary/api-usage`);
            showResponse('monitoringResponse', result);
        }

        async function getCacheStats() {
            const result = await makeRequest(`${API_BASE_URL}/glossary/cache-stats`);
            showResponse('monitoringResponse', result);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkHealth();
        });
    </script>
</body>
</html>
