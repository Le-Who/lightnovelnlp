# üö® –†–£–ß–ù–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ò 007

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 007 —Å–æ–∑–¥–∞–Ω–∞ –≤ –∫–æ–¥–µ
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ Render.com
- ‚ö†Ô∏è **–ú–∏–≥—Ä–∞—Ü–∏—è –ù–ï –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Neon.tech**
- ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ shell –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ

## üîß –í–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Render.com Shell (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

1. **–í–æ–π–¥–∏—Ç–µ –≤ Render.com Dashboard**
2. **–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à backend —Å–µ—Ä–≤–∏—Å**
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Shell"** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:**
   ```bash
   cd /opt/render/project/src
   python run_migration.py
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Neon.tech SQL Editor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ—Å–∫–æ–ª—å–∫—É —É –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ shell, **—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±** - –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é –≤ Neon.tech:

#### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ Neon.tech Dashboard
- –û—Ç–∫—Ä–æ–π—Ç–µ [console.neon.tech](https://console.neon.tech)
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**

#### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `order`:**
```sql
ALTER TABLE chapters 
ADD COLUMN "order" INTEGER NOT NULL DEFAULT 0;
```

**–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞:**
```sql
CREATE INDEX ix_chapters_order 
ON chapters (project_id, "order");
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Alembic:**
```sql
-- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ alembic_version
SELECT * FROM alembic_version;

-- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é
UPDATE alembic_version 
SET version_num = '007' 
WHERE version_num = '006';

-- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ—ë
INSERT INTO alembic_version (version_num) VALUES ('007');
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Render.com Deploy Trigger

1. **–°–¥–µ–ª–∞–π—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∫–æ–¥–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
2. **–ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
3. **Render.com –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
4. **–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–±–æ—Ä–∫–∏ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –º–∏–≥—Ä–∞—Ü–∏—è** (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω post-deploy hook)

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ß–µ—Ä–µ–∑ Render.com Environment Variables

1. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```
   AUTO_MIGRATE=true
   ```
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å** (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏)

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í Neon.tech SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–∫–∏:**
```sql
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns 
WHERE table_name = 'chapters' 
AND column_name = 'order';
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞:**
```sql
SELECT indexname, indexdef
FROM pg_indexes 
WHERE tablename = 'chapters' 
AND indexname = 'ix_chapters_order';
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Alembic:**
```sql
SELECT version_num FROM alembic_version;
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ "column already exists"
**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–ª–æ–Ω–∫–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —à–∞–≥.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ "index already exists"
**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω–¥–µ–∫—Å —É–∂–µ —Å–æ–∑–¥–∞–Ω, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —à–∞–≥.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ "table alembic_version does not exist"
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É:
```sql
CREATE TABLE alembic_version (
    version_num VARCHAR(32) NOT NULL PRIMARY KEY
);
INSERT INTO alembic_version (version_num) VALUES ('007');
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞:
- ALTER TABLE
- CREATE INDEX
- INSERT/UPDATE/DELETE

## ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

1. **–°–µ–π—á–∞—Å**: –ú–∏–≥—Ä–∞—Ü–∏—è 007 –≤ –∫–æ–¥–µ, –Ω–æ –Ω–µ –≤ –ë–î
2. **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—ã –≤ Neon.tech
3. **–ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–æ–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å, –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2** (Neon.tech SQL Editor)
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã**
4. **–ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ - –∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

## üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–¥:

```python
# –í main.py –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
@app.on_event("startup")
async def run_migrations():
    if os.getenv("AUTO_MIGRATE") == "true":
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        pass
```

---

**–í–ê–ñ–ù–û**: –ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Neon.tech, –º–∏–≥—Ä–∞—Ü–∏—è 007 –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π, –∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å –∫–æ–¥!
